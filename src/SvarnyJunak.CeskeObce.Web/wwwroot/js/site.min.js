var autoComplete=function(e){if(document.querySelector){var l={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(e,t,o){}};for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);for(var o="object"==typeof l.selector?[l.selector]:document.querySelectorAll(l.selector),n=0;n<o.length;n++){var s=o[n];s.sc=document.createElement("div"),s.sc.className="autocomplete-suggestions "+l.menuClass,s.autocompleteAttr=s.getAttribute("autocomplete"),s.setAttribute("autocomplete","off"),s.cache={},s.last_val="",s.updateSC=function(e,t){var o=s.getBoundingClientRect();if(s.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+l.offsetLeft)+"px",s.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+l.offsetTop)+"px",s.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(s.sc.style.display="block",s.sc.maxHeight||(s.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(s.sc,null):s.sc.currentStyle).maxHeight)),s.sc.suggestionHeight||(s.sc.suggestionHeight=s.sc.querySelector(".autocomplete-suggestion").offsetHeight),s.sc.suggestionHeight))if(t){var n=s.sc.scrollTop,a=t.getBoundingClientRect().top-s.sc.getBoundingClientRect().top;0<a+s.sc.suggestionHeight-s.sc.maxHeight?s.sc.scrollTop=a+s.sc.suggestionHeight+n-s.sc.maxHeight:a<0&&(s.sc.scrollTop=a+n)}else s.sc.scrollTop=0},u(window,"resize",s.updateSC),document.body.appendChild(s.sc),r("autocomplete-suggestion","mouseleave",function(e){var t=s.sc.querySelector(".autocomplete-suggestion.selected");t&&setTimeout(function(){t.className=t.className.replace("selected","")},20)},s.sc),r("autocomplete-suggestion","mouseover",function(e){var t=s.sc.querySelector(".autocomplete-suggestion.selected");t&&(t.className=t.className.replace("selected","")),this.className+=" selected"},s.sc),r("autocomplete-suggestion","mousedown",function(e){if(i(this,"autocomplete-suggestion")){var t=this.getAttribute("data-val");s.value=t,l.onSelect(e,t,this),s.sc.style.display="none"}},s.sc),s.blurHandler=function(){try{var t=document.querySelector(".autocomplete-suggestions:hover")}catch(e){t=0}t?s!==document.activeElement&&setTimeout(function(){s.focus()},20):(s.last_val=s.value,s.sc.style.display="none",setTimeout(function(){s.sc.style.display="none"},350))},u(s,"blur",s.blurHandler);var c=function(e){var t=s.value;if((s.cache[t]=e).length&&t.length>=l.minChars){for(var o="",n=0;n<e.length;n++)o+=l.renderItem(e[n],t);s.sc.innerHTML=o,s.updateSC(0)}else s.sc.style.display="none"};s.keydownHandler=function(e){var t,o=window.event?e.keyCode:e.which;if((40==o||38==o)&&s.sc.innerHTML)return(n=s.sc.querySelector(".autocomplete-suggestion.selected"))?(t=40==o?n.nextSibling:n.previousSibling)?(n.className=n.className.replace("selected",""),t.className+=" selected",s.value=t.getAttribute("data-val")):(n.className=n.className.replace("selected",""),s.value=s.last_val,t=0):((t=40==o?s.sc.querySelector(".autocomplete-suggestion"):s.sc.childNodes[s.sc.childNodes.length-1]).className+=" selected",s.value=t.getAttribute("data-val")),s.updateSC(0,t),!1;if(27==o)s.value=s.last_val,s.sc.style.display="none";else if(13==o||9==o){var n;(n=s.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=s.sc.style.display&&(l.onSelect(e,n.getAttribute("data-val"),n),setTimeout(function(){s.sc.style.display="none"},20))}},u(s,"keydown",s.keydownHandler),s.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(t<35||40<t)&&13!=t&&27!=t){var o=s.value;if(o.length>=l.minChars){if(o!=s.last_val){if(s.last_val=o,clearTimeout(s.timer),l.cache){if(o in s.cache)return void c(s.cache[o]);for(var n=1;n<o.length-l.minChars;n++){var a=o.slice(0,o.length-n);if(a in s.cache&&!s.cache[a].length)return void c([])}}s.timer=setTimeout(function(){l.source(o,c)},l.delay)}}else s.last_val=o,s.sc.style.display="none"}},u(s,"keyup",s.keyupHandler),s.focusHandler=function(e){s.last_val="\n",s.keyupHandler(e)},l.minChars||u(s,"focus",s.focusHandler)}this.destroy=function(){for(var e=0;e<o.length;e++){var t=o[e];a(window,"resize",t.updateSC),a(t,"blur",t.blurHandler),a(t,"focus",t.focusHandler),a(t,"keydown",t.keydownHandler),a(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}function i(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function u(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function a(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function r(n,e,a,t){u(t||document,e,function(e){for(var t,o=e.target||e.srcElement;o&&!(t=i(o,n));)o=o.parentElement;t&&a.call(o,e)})}};"function"==typeof define&&define.amd?define("autoComplete",function(){return autoComplete}):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete,document.getElementById("municipality-search").focus(),new autoComplete({minChars:1,selector:"input#municipality-search",onSelect:function(e,t,o){var n=o.getAttribute("data-val");document.querySelector("#municipality-search").value=n,document.querySelector("form#select-municipality-form").submit()},source:function(e,t){var o=new XMLHttpRequest;o.open("GET","/api/municipalities?name="+encodeURIComponent(e),!0),o.onload=function(){var e=JSON.parse(o.responseText);t(e)},o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send()}}),function(){var e,t=document.querySelectorAll(".data-population-progress>tbody>tr"),o=Array.prototype.map.call(t,function(e,t){return{year:Number(e.children[0].innerText),population:Number(e.children[1].innerText)}}),n=o.reduce(function(e,t){return e>t.population?e:t.population},0),a=330<(e=document.querySelector(".chart").offsetWidth-60)?330:e,l=document.querySelector(".chart"),s=o.map(function(e){return"<div><span class='year-caption'>"+e.year+"</span><span class='bar' data-width='"+e.population*a/n+"px' style='width: 0;visibility: hidden;transition: width 2s ease-out'>"+e.population.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+"</div>"});l.innerHTML=s.join(""),setTimeout(function(){var e=document.querySelectorAll(".chart div .bar");Array.prototype.slice.call(e).forEach(function(e){e.style.visibility="visible",e.style.width=e.getAttribute("data-width")})},500)}(),function(){var e=document.getElementById("map-canvas");"hidden"!==e.style.visibility&&400<e.offsetWidth&&(Loader.async=!0,Loader.load(null,null,function(){var e=Number(document.getElementById("Municipality_Latitude").value),t=Number(document.getElementById("Municipality_Longitude").value),o=SMap.Coords.fromWGS84(t,e),n=new SMap(JAK.gel("map-canvas"),o,13);n.addDefaultLayer(SMap.DEF_BASE).enable();var a=new SMap.Control.Sync({bottomSpace:30});n.addControl(a)}))}();